/** 
 * reLiftHTML v0.0.1
 * Copyright 2019 Mardix
 * Released under the MIT License
 * https://github.com/mardix/relift
 * --- Big up to:
 * https://github.com/sindresorhus/on-change
 * 
 */
const e={attrs(e){const t={};for(let n=0;n<e.attributes.length;n++){const r=e.attributes[n];t[r.name]=r.value}return t},nodesByKey(e,t){const n={};for(let r=0;r<e.childNodes.length;r++){const o=t(e.childNodes[r]);o&&(n[o]=e.childNodes[r])}return n},merge(e,t,n){if((n=n||{}).key=n.key||(e=>e.id),"string"==typeof t){const n=t;(t=document.createElement(e.tagName)).innerHTML=n}const r={old:this.nodesByKey(e,n.key),new:this.nodesByKey(t,n.key)};let o;for(o=0;t.firstChild;o++){const s=t.removeChild(t.firstChild);if(o>=e.childNodes.length){e.appendChild(s);continue}let i=e.childNodes[o];const l=n.key(s);if(n.key(i)||l){const t=l&&l in r.old?r.old[l]:s;t!==i&&(i=e.insertBefore(t,i))}if(i.nodeType!==s.nodeType||i.tagName!==s.tagName)e.replaceChild(s,i);else if([Node.TEXT_NODE,Node.COMMENT_NODE].indexOf(i.nodeType)>=0){if(i.textContent===s.textContent)continue;i.textContent=s.textContent}else if(i!==s){const e={base:this.attrs(i),new:this.attrs(s)};for(const t in e.base)t in e.new||i.removeAttribute(t);for(const t in e.new)t in e.base&&e.base[t]===e.new[t]||i.setAttribute(t,e.new[t]);this.merge(i,s)}}for(;e.childNodes.length>o;)e.removeChild(e.lastChild)}},t=(e,t)=>(t&&t.toString&&(e&&(e+="."),e+=t.toString()),e),n=Symbol("ProxyTarget");var r=(e,r)=>{let o=!1,s=!1;const i=new WeakMap,l=new WeakMap,c=(e,n,i,l)=>{o?s||(s=!0):r.call(d,t(e,n),l,i)},a=(e,t)=>{const n=i.get(e);n&&n.delete(t)},u={get(e,r,o){if("___target___"===r)return e;if(r===n)return e;const s=Reflect.get(e,r,o);if((e=>null===e||"object"!=typeof e&&"function"!=typeof e)(s)||"constructor"===r)return s;const c=((e,t)=>{let n=i.get(e);if(n)return n;n=new Map,i.set(e,n);let r=n.get(t);return r||(r=Reflect.getOwnPropertyDescriptor(e,t),n.set(t,r)),r})(e,r);if(c&&!c.configurable){if(c.set&&!c.get)return;if(!1===c.writable)return s}return l.set(s,t(l.get(e),r)),new Proxy(s,u)},set(e,t,r,o){r&&void 0!==r[n]&&(r=r[n]);const s=Reflect.get(e,t,o),i=Reflect.set(e,t,r);return s!==r&&c(l.get(e),t,s,r),i},defineProperty(e,t,n){const r=Reflect.defineProperty(e,t,n);return a(e,t),c(l.get(e),t,void 0,n.value),r},deleteProperty(e,t){const n=Reflect.get(e,t),r=Reflect.deleteProperty(e,t);return a(e,t),c(l.get(e),t,n),r},apply(e,t,n){if(!o){o=!0;const i=Reflect.apply(e,t,n);return s&&r(),o=!1,s=!1,i}return Reflect.apply(e,t,n)}};l.set(e,"");const d=new Proxy(e,u);return d};const o=["keydown","keypress","keyup","focus","blur","hover","change","input","reset","submit","click","dblclick","mouseenter","mouseleave","mousedown","mousemove","mouseout","mouseover","mouseup","contextmenu","select","drag","dragend","dragenter","dragstart","dragleave","drop","cut","copy","paste"],s="r-on_events",i=e=>`r-on-${e}`;function l(e,t){function n(e){Array.from(e.querySelectorAll(`[${s}]`)).map(e=>{(e.getAttribute(s)||"").split(",").filter(e=>e).map(n=>{e[`on${n}`]=function(e){const n=arguments[1],r=n.type;try{n.preventDefault(),t[e].call(t,n)}catch(t){console.error(`Events Handler Error: '${e}()' on '${r}'`,t)}}.bind(this,e.getAttribute(i(n)))})})}const r=new MutationObserver(e=>{[...e].filter(e=>e.addedNodes.length>0).map(e=>e.target).map(e=>n(e))});return r.observe(e,{attributes:!0,characterData:!0,childList:!0,subtree:!0,attributeOldValue:!0,characterDataOldValue:!0}),n(e),r}const c={$for:function(e,t,n){const r=/(.*)\s+(in)\s+(.*)$/.exec(t);if(4===r.length){const t=r[1].replace("(","").replace(")",""),o=r[3];g(e,`\${${o}.map(function(${t}) { return \``,"`}.bind(this)).join('')}"),f(e,n)}},$if:function(e,t,n){f(e,n),b(e,`\${${t} ? `);const r=e.nextElementSibling;r&&u(r,"else")?(g(e,"`","`"),f(r,"else"),g(r,":`","`}")):g(e,"`","`:``}")},disabled:function(e,t,n){e.setAttribute("disabled",`\${ ${t} ? true : false}`)},$value:function(e,t,n){const r=e.nodeName.toLowerCase();d(e,"default");u(e,"default")&&f(e,"default");"textarea"===r?e.innerHTML=`\${${t}}`:"input"===r&&(["radio","checkbox"].includes(e.getAttribute("type"))||e.setAttribute("value",`\${${t}}`));f(e,n)}},a=e=>`r-${e}`,u=(e,t)=>e.hasAttribute(a(t)),d=(e,t)=>e.getAttribute(a(t)),f=(e,t)=>e.removeAttribute(a(t)),p=(e,t)=>e.querySelectorAll(`[${a(t)}]`),b=(e,t)=>e.insertAdjacentText("beforebegin",t),g=(e,t,n)=>{b(e,t),((e,t)=>e.insertAdjacentText("afterend",t))(e,n)};const m=(e,t)=>e&&"function"==typeof e[t],y=e=>(new DOMParser).parseFromString(e,"text/html").body.firstChild,h=e=>t=>new Function(`return \`${e}\``).call(t),$=(e,t)=>{let n=null,r=void 0,o=void 0;return s=>{const i=s.___target___?{...s.___target___}:{...s};n&&((e,t)=>JSON.stringify(e)===JSON.stringify(t))(n,i)||(o=t(n=i)),r!==o&&(r=o,s[e]=o)}};function _(e={},t={}){const n=[],o=Object.keys(e).filter(t=>!m(e,t)).reduce((t,n)=>({...t,[n]:e[n]}),{}),s=Object.keys(e).filter(t=>m(e,t)).map(t=>$(t,e[t])),i=Object.keys(t).filter(e=>m(t,e)).reduce((e,n)=>({...e,[n]:(...e)=>(t[n].call(this,l,...e),i)}),{});let l=r(o,()=>{s.forEach(e=>e(l)),n.forEach(e=>e(l.___target___))});return s.forEach(e=>e(l)),{...i,$getState:()=>l.___target___,$subscribe:e=>(n.push(e),()=>n.splice(n.indexOf(e),1))}}function A(t,n={},r=null){r&&(t.innerHTML=r);const a=t.cloneNode(!0);!function(e){for(const t of e.querySelectorAll("[\\@call]")){const e=t.getAttribute("@call");t.removeAttribute("@call");let n=["click"];t instanceof HTMLInputElement||t instanceof HTMLTextAreaElement?n=["input","paste"]:t instanceof HTMLInputElement?n=["change"]:t instanceof HTMLFormElement?n=["submit"]:t instanceof HTMLAnchorElement&&t.setAttribute("href","javascript:void(0);");let r=(t.getAttribute(s)||"").split(",").filter(e=>e);r=r.concat(n),t.setAttribute(s,r.join(","));for(const r of n)t.setAttribute(i(r),e)}for(const t of o)for(const n of e.querySelectorAll(`[\\@${t}]`)){const e=(n.getAttribute(s)||"").split(",").filter(e=>e);e.push(t),n.setAttribute(s,e.join(",")),n.setAttribute(i(t),n.getAttribute(`@${t}`)),n.removeAttribute(`@${t}`),n instanceof HTMLAnchorElement&&n.setAttribute("href","javascript:void(0);")}}(a),function(e,t={}){const n={...t,...c};for(const t in n){const r=t.replace("$","");for(const o of p(e,r))if(u(o,r)){const e=d(o,r);n[t](o,e,r)}}}(a),t.innerHTML=a.innerHTML,l(t,n);const f=h(a.outerHTML);return n=>{const r=y(f(n));return e.merge(t,r)}}export default function(e={}){const t=["data","el","template","store","mounted","updated"],n={data:{},el:document.body,template:null,store:{},mounted:()=>{},updated:()=>{},...e},o="string"==typeof n.el?document.querySelector(n.el):n.el;if(!(o instanceof HTMLElement))throw new Error(`reLiftHTML setup error: 'el' is not a DOM Element. >> el: ${n.el}`);const s=n.template?n.template:o.innerHTML,i=Object.keys(n).filter(e=>!t.includes(e)).filter(e=>!e.startsWith("$")).filter(e=>m(n,e)).reduce((e,t)=>({...e,[t]:n[t]}),{}),l=Object.keys(n.data).filter(e=>!m(n.data,e)).reduce((e,t)=>({...e,[t]:n.data[t]}),{}),c=Object.keys(n.data).filter(e=>m(n.data,e)).map(e=>$(e,n.data[e]));function a(e){c.forEach(t=>t(e))}let u={$store:{},...l},d=void 0;Object.keys(n.store).length&&(d=n.store,u.$store=n.store.$getState(),n.store.$subscribe(e=>{u.$store=n.store.$getState(),a(u),b()}));const f=r(u,()=>{a(u),b()}),p={...i,el:o,data:f,render:b,store:d};function b(){g(u)&&n.updated.call(p)}const g=A(o,p,s);document.addEventListener("DOMContentLoaded",()=>{a(u),g(u),n.mounted.call(p),o.style.display="block"})}export{_ as reLiftState};

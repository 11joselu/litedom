/** 
 * reLift-HTML v0.0.4
 * Copyright 2019 Mardix mcx2082@gmail.com
 * License: MIT
 * https://github.com/mardix/relift-html
 * Build date: 4/26/2019, 1:22:08 PM
 * 
 */
const e={attrs(e){const t={};for(let n=0;n<e.attributes.length;n++){const r=e.attributes[n];t[r.name]=r.value}return t},nodesByKey(e,t){const n={};for(let r=0;r<e.childNodes.length;r++){const o=t(e.childNodes[r]);o&&(n[o]=e.childNodes[r])}return n},merge(e,t,n){if((n=n||{}).key=n.key||(e=>e.id),"string"==typeof t){const n=t;(t=document.createElement(e.tagName)).innerHTML=n}const r={old:this.nodesByKey(e,n.key),new:this.nodesByKey(t,n.key)};let o;for(o=0;t.firstChild;o++){const s=t.removeChild(t.firstChild);if(o>=e.childNodes.length){e.appendChild(s);continue}let i=e.childNodes[o];const l=n.key(s);if(n.key(i)||l){const t=l&&l in r.old?r.old[l]:s;t!==i&&(i=e.insertBefore(t,i))}if(i.nodeType!==s.nodeType||i.tagName!==s.tagName)e.replaceChild(s,i);else if([Node.TEXT_NODE,Node.COMMENT_NODE].indexOf(i.nodeType)>=0){if(i.textContent===s.textContent)continue;i.textContent=s.textContent}else if(i!==s){const e={base:this.attrs(i),new:this.attrs(s)};for(const t in e.base)t in e.new||i.removeAttribute(t);for(const t in e.new)t in e.base&&e.base[t]===e.new[t]||i.setAttribute(t,e.new[t]);this.merge(i,s)}}for(;e.childNodes.length>o;)e.removeChild(e.lastChild)}},t=(e,t)=>(t&&t.toString&&(e&&(e+="."),e+=t.toString()),e),n=Symbol("ProxyTarget");var r=(e,r)=>{let o=!1,s=!1;const i=new WeakMap,l=new WeakMap,c=(e,n,i,l)=>{o?s||(s=!0):r.call(d,t(e,n),l,i)},a=(e,t)=>{const n=i.get(e);n&&n.delete(t)},u={get(e,r,o){if("___target___"===r)return e;if(r===n)return e;const s=Reflect.get(e,r,o);if((e=>null===e||"object"!=typeof e&&"function"!=typeof e)(s)||"constructor"===r)return s;const c=((e,t)=>{let n=i.get(e);if(n)return n;n=new Map,i.set(e,n);let r=n.get(t);return r||(r=Reflect.getOwnPropertyDescriptor(e,t),n.set(t,r)),r})(e,r);if(c&&!c.configurable){if(c.set&&!c.get)return;if(!1===c.writable)return s}return l.set(s,t(l.get(e),r)),new Proxy(s,u)},set(e,t,r,o){r&&void 0!==r[n]&&(r=r[n]);const s=Reflect.get(e,t,o),i=Reflect.set(e,t,r);return s!==r&&c(l.get(e),t,s,r),i},defineProperty(e,t,n){const r=Reflect.defineProperty(e,t,n);return a(e,t),c(l.get(e),t,void 0,n.value),r},deleteProperty(e,t){const n=Reflect.get(e,t),r=Reflect.deleteProperty(e,t);return a(e,t),c(l.get(e),t,n),r},apply(e,t,n){if(!o){o=!0;const i=Reflect.apply(e,t,n);return s&&r(),o=!1,s=!1,i}return Reflect.apply(e,t,n)}};l.set(e,"");const d=new Proxy(e,u);return d};const o=["keydown","keypress","keyup","focus","blur","hover","change","input","reset","submit","click","dblclick","mouseenter","mouseleave","mousedown","mousemove","mouseout","mouseover","mouseup","contextmenu","select","drag","dragend","dragenter","dragstart","dragleave","drop","cut","copy","paste"],s="r-events-list",i=e=>`r-on-${e}`;const l={$for:function(e,t,n){const r=/(.*)\s+(in)\s+(.*)$/.exec(t);if(4===r.length){const t=r[1].replace("(","").replace(")",""),o=r[3];m(e,`\${${o}.map(function(${t}) { return \``,"`}.bind(this)).join('')}"),d(e,n)}},$if:function(e,t,n){d(e,n),p(e,`\${${t} ? `);const r=e.nextElementSibling;r&&a(r,"else")?(m(e,"`","`"),d(r,"else"),m(r,":`","`}")):m(e,"`","`:``}")},disabled:function(e,t,n){e.setAttribute("disabled",`\${ ${t} ? true : false}`)},$value:function(e,t,n){const r=e.nodeName.toLowerCase();u(e,"default");a(e,"default")&&d(e,"default");"textarea"===r?e.innerHTML=`\${${t}}`:"input"===r&&(["radio","checkbox"].includes(e.getAttribute("type"))||e.setAttribute("value",`\${${t}}`));d(e,n)}};const c=e=>`r-${e}`,a=(e,t)=>e.hasAttribute(c(t)),u=(e,t)=>e.getAttribute(c(t)),d=(e,t)=>e.removeAttribute(c(t)),f=(e,t)=>e.querySelectorAll(`[${c(t)}]`),p=(e,t)=>e.insertAdjacentText("beforebegin",t),m=(e,t,n)=>{p(e,t),((e,t)=>e.insertAdjacentText("afterend",t))(e,n)};const b=(e,t)=>e&&"function"==typeof e[t],g=e=>(new DOMParser).parseFromString(e,"text/html").body.firstChild,y=e=>t=>new Function(`return \`${e}\``).call(t),h=(e,t)=>n=>n[e]=t({...n});function A(t,n={},r=null){r&&(t.innerHTML=r);const c=t.cloneNode(!0);!function(e){for(const t of e.querySelectorAll("[\\@call]")){const e=t.getAttribute("@call");t.removeAttribute("@call");let n=["click"];t instanceof HTMLInputElement||t instanceof HTMLTextAreaElement?n=["input","paste"]:t instanceof HTMLSelectElement?n=["change"]:t instanceof HTMLFormElement?n=["submit"]:t instanceof HTMLAnchorElement&&t.setAttribute("href","javascript:void(0);");let r=(t.getAttribute(s)||"").split(",").filter(e=>e);r=r.concat(n),t.setAttribute(s,r.join(","));for(const r of n)t.setAttribute(i(r),e)}for(const t of o)for(const n of e.querySelectorAll(`[\\@${t}]`)){const e=(n.getAttribute(s)||"").split(",").filter(e=>e);e.push(t),n.setAttribute(s,e.join(",")),n.setAttribute(i(t),n.getAttribute(`@${t}`)),n.removeAttribute(`@${t}`),n instanceof HTMLAnchorElement&&n.setAttribute("href","javascript:void(0);")}}(c),function(e,t={}){const n={...t,...l};for(const t in n){const r=t.replace("$","");for(const o of f(e,r))if(a(o,r)){const e=u(o,r);n[t](o,e,r)}}}(c),t.innerHTML=c.innerHTML,function(e,t){function n(e){Array.from(e.querySelectorAll(`[${s}]`)).map(e=>{(e.getAttribute(s)||"").split(",").filter(e=>e).map(n=>{e[`on${n}`]=(r=>{r.preventDefault();const o=e.getAttribute(i(n));t[o].call(t,r)})})})}const r=new MutationObserver(e=>{[...e].filter(e=>e.addedNodes.length>0).map(e=>e.target).map(e=>n(e))});r.observe(e,{attributes:!0,childList:!0,subtree:!0}),n(e)}(t,n);const d=y(c.outerHTML);return n=>{const r=g(d(n));return e.merge(t,r)}}export default function(e={}){const t=["data","el","template","store","mounted","updated"],n={data:{},el:document.body,template:null,store:{},mounted:()=>{},updated:()=>{},...e},o="string"==typeof n.el?document.querySelector(n.el):n.el;if(!(o instanceof HTMLElement))throw new Error(`reLiftHTML setup error: 'el' is not a DOM Element. >> el: ${n.el}`);const s=n.template?n.template:o.innerHTML,i=Object.keys(n).filter(e=>!t.includes(e)).filter(e=>!e.startsWith("$")).filter(e=>b(n,e)).reduce((e,t)=>({...e,[t]:n[t]}),{}),l=Object.keys(n.data).filter(e=>!b(n.data,e)).reduce((e,t)=>({...e,[t]:n.data[t]}),{}),c=Object.keys(n.data).filter(e=>b(n.data,e)).map(e=>h(e,n.data[e])),a=e=>c.forEach(t=>t(e));let u={$store:{},...l},d=void 0;Object.keys(n.store).length&&(d=n.store,u.$store=n.store.getState(),n.store.subscribe(e=>{u.$store=n.store.getState(),a(u),m()}));const f=r(u,()=>{a(u),m()}),p={...i,el:o,data:f,render:m,store:d};function m(){g(u)&&n.updated.call(p)}const g=A(o,p,s);document.addEventListener("DOMContentLoaded",()=>{a(u),g(u),n.mounted.call(p),o.style.display="block"})}

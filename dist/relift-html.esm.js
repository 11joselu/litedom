/** 
 * reLift-HTML v0.10.2
 * Copyright 2019 Mardix mcx2082@gmail.com
 * License: MIT
 * https://github.com/mardix/relift-html
 * Build date: 6/23/2019, 6:49:12 PM
 * 
 */
const t=t=>Object.keys(t).map(e=>`${(t=>t.replace(/([a-zA-Z])(?=[A-Z])/g,"$1-").toLowerCase())(e)}: ${t[e]};`).join(" "),e=(t,e,n)=>{let r=t;const o=e.split(".");for(;o.length;){const t=o.shift();r[t]=o.length?r[t]?r[t]:{}:n,r=r[t]}},n=(t,e)=>e.split(".").reduce((t,e)=>t&&t[e],t),r=(t,e)=>t&&"function"==typeof t[e],o=t=>"string"==typeof t?document.querySelector(t):t,s=t=>(new DOMParser).parseFromString(t,"text/html").body,i=t=>Object.freeze(Array.from(t.attributes).map(t=>({[t.name]:t.value})).reduce((t,e)=>({...t,...e}),{})),c=(t,e)=>{let n=!1,r=!1;const o=new WeakMap,s=()=>{n?r||(r=!0):e()},i={get(t,e,n){if("___target___"===e)return t;const r=Reflect.get(t,e,n);if((t=>null===t||!["function","object"].includes(typeof t))(r)||"constructor"===e)return r;const s=((t,e)=>{let n=o.get(t);if(n)return n;n=new Map,o.set(t,n);let r=n.get(e);return r||(r=Reflect.getOwnPropertyDescriptor(t,e),n.set(e,r)),r})(t,e);if(s&&!s.configurable){if(s.set&&!s.get)return;if(!1===s.writable)return r}return new Proxy(r,i)},set(t,e,n,r){n&&void 0!==n.___target___&&(n=n.___target___);const o=Reflect.get(t,e,r),i=Reflect.set(t,e,n);return o!==n&&s(),i},defineProperty(t,e,n){const r=Reflect.defineProperty(t,e,n);return s(),r},deleteProperty(t,e){const n=Reflect.deleteProperty(t,e);return s(),n},apply(t,o,s){if(!n){n=!0;const i=Reflect.apply(t,o,s);return r&&e(),n=r=!1,i}return Reflect.apply(t,o,s)}};return new Proxy(t,i)};const l=t=>(function t(e){return null===e||"object"!=typeof e?e:(Object.keys(e).forEach(function(n){const r=e[n];null!==r&&"object"==typeof r&&t(r)}),Object.freeze(e))})(function(t){if(null===t||"object"!=typeof t)return t;var e=t.constructor();for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=l(t[n]));return e}(t)),a=(t,e)=>Array.from(t.childNodes).filter(t=>e(t)).map(t=>({[e(t)]:t})).reduce((t,e)=>({...t,...e}),{});const u=[];for(const t in document){const e=null===document[t]||"function"==typeof document[t];t.startsWith("on")&&e&&u.push(t.substring(2))}const f="r-e-list",d=t=>`r-on-${t}`;const p={$for:function(t,e,n){const r=/(.*)\s+(in)\s+(.*)$/.exec(e);if(4===r.length){const e=r[1].replace("(","").replace(")",""),o=r[3];A(t,`\${${o}.map(function(${e}) { return \``,"`}.bind(this)).join('')}"),g(t,n)}},$if:function(t,e,n){g(t,n),$(t,`\${${e} ? `);const r=t.nextElementSibling;r&&m(r,"else")?(A(t,"`","`"),g(r,"else"),A(r,":`","`}")):A(t,"`","`:``}")},$class:function(t,e,n){const r=e.split(";").map(t=>t.split(":",2).map(t=>t.trim())).map(t=>`\${${t[1]} ? '${t[0]}': ''}`).join(" "),o=t.getAttribute("class")||""+` ${r}`;t.setAttribute("class",o),g(t,n)},$style:function(t,e,n){}};const h=t=>`$${t}`,m=(t,e)=>t.hasAttribute(h(e)),b=(t,e)=>t.getAttribute(h(e)),g=(t,e)=>t.removeAttribute(h(e)),y=(t,e)=>t.querySelectorAll(`[\\${h(e)}]`),$=(t,e)=>t.insertAdjacentText("beforebegin",e),A=(t,e,n)=>{$(t,e),((t,e)=>t.insertAdjacentText("afterend",e))(t,n)};const _=["data","el","shadowDOM","template","created","updated","removed","$store","prop","tagName"],v=t=>Object.keys(t).filter(t=>!_.includes(t)).filter(e=>r(t,e)).reduce((e,n)=>({...e,[n]:t[n]}),{}),M=t=>Object.keys(t).filter(e=>!r(t,e)).reduce((e,n)=>({...e,[n]:t[n]}),{}),N=t=>Object.keys(t).filter(e=>r(t,e)).map(e=>((t,e)=>n=>n[t]=e({...n}))(e,t[e])),j=t=>e=>(e.$store=t.getState(),t.subscribe(n=>e.$store={...t.getState()})),w=(t,e,n)=>{Object.keys(e).filter(t=>!t.startsWith("_")).map(r=>t[r]=e[r].bind(n))},x=t=>{const e=s((t=>t.replace(/\$?\{([^\;\{]+)\}/g,(t,e)=>`\${${e}}`))(t));!function(t,e={}){const n={...e,...p};for(const e in n){const r=e.replace("$","");for(const o of y(t,r))if(m(o,r)){const t=b(o,r);n[e](o,t,r)}}}(e),function(t){for(const e of t.querySelectorAll("[\\@call], [\\@bind]")){let t=e.getAttribute("@call");const n=e.hasAttribute("@bind");e.removeAttribute("@call"),n&&(e.setAttribute("r-data-key",e.getAttribute("@bind")),e.removeAttribute("@bind"),t="__$bindInput");let r=["click"];e instanceof HTMLInputElement||e instanceof HTMLTextAreaElement?r=["input","paste"]:e instanceof HTMLSelectElement?r=["change"]:e instanceof HTMLFormElement?r=["submit"]:e instanceof HTMLAnchorElement&&e.setAttribute("href","javascript:void(0);");let o=(e.getAttribute(f)||"").split(",").filter(t=>t);o=o.concat(r),e.setAttribute(f,o.join(","));for(const n of r)e.setAttribute(d(n),t)}for(const e of u)for(const n of t.querySelectorAll(`[\\@${e}]`)){const t=(n.getAttribute(f)||"").split(",").filter(t=>t);t.push(e),n.setAttribute(f,t.join(",")),n.setAttribute(d(e),n.getAttribute(`@${e}`)),n.removeAttribute(`@${e}`),n instanceof HTMLAnchorElement&&n.setAttribute("href","javascript:void(0);")}}(e);const n=(t=>t.replace(/&lt;/g,"<").replace(/&gt;/g,">"))(e.innerHTML),r=(t=>e=>new Function(`return \`${t}\``).call(e))(n);return{html:n,render:(t,e)=>{const n=s(r(e));return!t.isEqualNode(n)&&function t(e,n,r={}){if(r={key:t=>t.id,...r},"string"==typeof n){const t=n;(n=document.createElement(e.nodeName)).innerHTML=t}const o=a(e,r.key);let s;for(s=0;n.firstChild;s++){const c=n.removeChild(n.firstChild);if(s>=e.childNodes.length){e.appendChild(c);continue}let l=e.childNodes[s];const a=r.key(c);if(r.key(l)||a){const t=a&&a in o?o[a]:c;t!==l&&(l=e.insertBefore(t,l))}if(l.nodeType!==c.nodeType||l.tagName!==c.tagName)e.replaceChild(c,l);else if([Node.TEXT_NODE,Node.COMMENT_NODE].indexOf(l.nodeType)>=0)l.textContent!==c.textContent&&(l.textContent=c.textContent);else if(l!==c){const e=i(l),n=i(c);for(const t in e)t in n||l.removeAttribute(t);for(const t in n)t in e&&e[t]===n[t]||l.setAttribute(t,n[t]);t(l,c)}}for(;e.childNodes.length>s;)e.removeChild(e.lastChild);return!0}(t,n)}}};function T(t){const r=t.target,o=r.getAttribute("r-data-key");if("checkbox"===r.type){const t=n(this.data,o)||[];e(this.data,o,r.checked?t.concat(r.value):t.filter(t=>t!=r.value))}else r.options&&r.multiple?e(this.data,o,[].reduce.call(r,(t,e)=>e.selected?t.concat(e.value):t,[])):e(this.data,o,r.value)}function O(e={}){const n={shadowDOM:!1,tagName:null,data:{},template:null,$store:{getState:()=>{},subscribe:()=>()=>{}},created(){},updated(){},removed(){},...e},r=j(n.$store),o=x(n.template),s=v(n),a=M(n.data),u=N(n.data),p=t=>u.forEach(e=>e(t));window.customElements.define(n.tagName.toLowerCase(),class extends HTMLElement{constructor(){super(),this.$root=n.shadowDOM?this.attachShadow({mode:"open"}):this}connectedCallback(){this.state={...this.state,...a,prop:i(this)};const e=c(this.state,()=>{p(this.state),o.render(this.$root,this.state)&&n.updated.call(this.context)});this.disconnectStore=r(e),this.$root.innerHTML=o.html,this.context={...s,data:e,el:this.$root,prop:this.state.prop,$store:n.$store,___$globals:{styleMap:t}},function(t,e){function n(t){Array.from(t.querySelectorAll(`[${f}]`)).map(t=>{(t.getAttribute(f)||"").split(",").filter(t=>t).map(n=>{t[`on${n}`]=(r=>{r.preventDefault();const o=t.getAttribute(d(n));e[o].call(e,r)})})})}const r=new MutationObserver(t=>{[...t].filter(t=>t.addedNodes.length>0).map(t=>t.target).map(t=>n(t))});r.observe(t,{attributes:!0,childList:!0,subtree:!0}),n(t)}(this.$root,{...this.context,__$bindInput:T}),w(this,s,this.context),p(this.state),o.render(this.$root,this.state),n.created.call(this.context)}disconnectedCallback(){n.removed.call(this.context),this.disconnectStore()}get data(){return l(this.state)}})}const E=t=>new Error(`reLift-HTML Error: ${t}`),k=()=>`relift-ce-${((t=7)=>Math.random().toString(36).substr(2,t).toLowerCase())()}`;function C(t){const e={el:null,refId:null,template:null,tagName:null,shadowDOM:!1,...t};let n=null;const r=!!e.tagName;if(e.tagName=e.tagName||k(),e.el&&((n=o(e.el)).style.display="block",e.template||(e.template=n.innerHTML),n.innerHTML="",!r)){const t=document.createElement(e.tagName);e.refId&&t.setAttribute("ref-id",e.refId),n.parentNode.replaceChild(t,n)}if(!e.template)throw E("missing 'template' option or 'el' are not valid elements");O(e)}export default function(t){Array.isArray(t)?t.map(t=>C(t)):C(t)}

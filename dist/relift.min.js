/** 
 * reLift v0.0.1
 * Copyright 2019 Mardix
 * Released under the MIT License
 * https://github.com/mardix/relift
 * --- Big up to:
 * https://github.com/sindresorhus/on-change
 * 
 */
const e=(e,t)=>(t&&t.toString&&(e&&(e+="."),e+=t.toString()),e),t=Symbol("ProxyTarget"),r=(r,n)=>{let o=!1,l=!1;const i=new WeakMap,s=new WeakMap,a=(t,r,i,s)=>{o?l||(l=!0):n.call(d,e(t,r),s,i)},c=(e,t)=>{const r=i.get(e);r&&r.delete(t)},u={get(r,n,o){if("___target___"===n)return r;if(n===t)return r;const l=Reflect.get(r,n,o);if((e=>null===e||"object"!=typeof e&&"function"!=typeof e)(l)||"constructor"===n)return l;const a=((e,t)=>{let r=i.get(e);if(r)return r;r=new Map,i.set(e,r);let n=r.get(t);return n||(n=Reflect.getOwnPropertyDescriptor(e,t),r.set(t,n)),n})(r,n);if(a&&!a.configurable){if(a.set&&!a.get)return;if(!1===a.writable)return l}return s.set(l,e(s.get(r),n)),new Proxy(l,u)},set(e,r,n,o){n&&void 0!==n[t]&&(n=n[t]);const l=Reflect.get(e,r,o),i=Reflect.set(e,r,n);return l!==n&&a(s.get(e),r,l,n),i},defineProperty(e,t,r){const n=Reflect.defineProperty(e,t,r);return c(e,t),a(s.get(e),t,void 0,r.value),n},deleteProperty(e,t){const r=Reflect.get(e,t),n=Reflect.deleteProperty(e,t);return c(e,t),a(s.get(e),t,r),n},apply(e,t,r){if(!o){o=!0;const i=Reflect.apply(e,t,r);return l&&n(),o=!1,l=!1,i}return Reflect.apply(e,t,r)}};s.set(r,"");const d=new Proxy(r,u);return d},n=(e,t)=>{let r=null,n=void 0,o=void 0;return l=>{const i=l.___target___?{...l.___target___}:{...l};r&&((e,t)=>JSON.stringify(e)===JSON.stringify(t))(r,i)||(o=t(r=i)),n!==o&&(n=o,l[e]=o)}},o=(e,t)=>e&&"function"==typeof e[t],l=["keydown","keypress","keyup","focus","blur","hover","change","input","reset","submit","click","dblclick","mouseenter","mouseleave","mousedown","mousemove","mouseout","mouseover","mouseup","contextmenu","select","drag","dragend","dragenter","dragstart","dragleave","drop","cut","copy","paste"],i="r-on_events",s={$for:function(e,t,r){const n=/(.*)\s+(in)\s+(.*)$/.exec(t);if(4===n.length){const t=n[1].replace("(","").replace(")",""),o=n[3];p(e,`\${${o}.map(function(${t}) { return \``,"`}.bind(this)).join('')}"),d(e,r)}},$if:function(e,t,r){d(e,r),b(e,`\${${t} ? `);const n=e.nextElementSibling;n&&c(n,"else")?(p(e,"`","`"),d(n,"else"),p(n,":`","`}")):p(e,"`","`:``}")},disabled:function(e,t,r){e.setAttribute("disabled",`\${ ${t} ? true : false}`)},$class:function(e,t,r){e.hasAttribute("class")||e.setAttribute("class","");let n=e.getAttribute("class");e.setAttribute("class",n),d(e,r)}},a=e=>`r-${e}`,c=(e,t)=>e.hasAttribute(a(t)),u=(e,t)=>e.getAttribute(a(t)),d=(e,t)=>e.removeAttribute(a(t)),f=(e,t)=>e.querySelectorAll(`[${a(t)}]`),b=(e,t)=>e.insertAdjacentText("beforebegin",t),p=(e,t,r)=>{b(e,t),((e,t)=>e.insertAdjacentText("afterend",t))(e,r)},m=e=>`r-on-${e}`;const g=e=>e&&e.dataset&&void 0!==e.dataset.proxy,h=(e,t,r)=>{if(e[r]!==t[r])return t[r]=e[r],e[r]?t.setAttribute(r,""):t.removeAttribute(r),!0},y=(e,t)=>e.id?e.id===t.id:e.isSameNode?e.isSameNode(t):e.tagName===t.tagName&&(3===e.type&&e.nodeValue===t.nodeValue),v=(e,t,r)=>{switch(e){case"INPUT":((e,t)=>{let r=e.value;const n=t.value;let o=!1;r&&"undefined"!==r||(r=""),h(e,t,"checked"),h(e,t,"disabled"),r!==n&&(o=!0,t.setAttribute("value",r),t.value=r),"null"===r&&(o=!0,t.value="",t.removeAttribute("value")),e.hasAttributeNS(null,"value")?"range"===t.type&&(o=!0,t.value=r):(o=!0,t.removeAttribute("value"))})(t,r);break;case"OPTION":h(t,r,"selected");break;case"TEXTAREA":((e,t)=>{let r=!1,n=e.value;if(n&&"undefined"!==n||(n=""),n!==t.value&&(t.value=n,r=!0),t.firstChild&&t.firstChild.nodeValue!==n){if(""===n&&t.firstChild.nodeValue===t.placeholder)return;t.firstChild.nodeValue=n,r=!0}})(t,r)}},A=(e,t)=>{const r=e.nodeType,n=e.nodeName;1===r&&((e,t)=>{const r=e.attributes,n=t.attributes;[Array.from(r).filter(e=>!(e in n)).map(t=>!e.removeAttribute(t)),Array.from(n).filter(e=>!(e in r||r[e]===n[e])).map(t=>!e.setAttribute(t,n[t]))].some(e=>e)})(t,e),3!==r&&8!==r||t.nodeValue!==e.nodeValue&&(t.nodeValue=e.nodeValue),v(n,e,t)},$=(e,t)=>t?e?e.isSameNode&&e.isSameNode(t)?t:e.tagName!==t.tagName?e:(A(e,t),((e,t)=>{let r,n,o,l,i=0,s=!0;for(let a=0;r=t.childNodes[a],n=e.childNodes[a-i],r||n;a++)if(n)if(r)if(y(n,r))(o=$(n,r))!==r&&(s=!0,t.replaceChild(o,r),i++);else{l=null;for(let e=a;e<t.childNodes.length;e++)if(y(t.childNodes[e],n)){l=t.childNodes[e];break}l?((o=$(n,l))!==l&&i++,s=!0,t.insertBefore(o,r)):n.id||r.id?(g(n)&&!n.isSameNode(r)&&n.realNode?(s=!0,t.insertBefore(n.realNode,r)):(s=!0,t.insertBefore(n,r)),i++):(o=$(n,r))!==r&&(s=!0,t.replaceChild(o,r),i++)}else s=!0,t.appendChild(n),i++;else s=!0,t.removeChild(r),a--})(e,t),t):null:e,_=e=>(new DOMParser).parseFromString(e,"text/html").body.firstChild,N=(e,t)=>new Function(`return \`${e}\``).call(t);function T(e,t){function r(e){Array.from(e.querySelectorAll(`[${i}]`)).map(e=>n(e))}function n(e,r=!1){e&&e.getAttribute&&(e.getAttribute("r-on_events")||"").split(",").filter(e=>e).map(n=>{e[`on${n}`]=r?void 0:function(e){const r=arguments[1],n=r.type;try{r.preventDefault(),t[e].call(t,r)}catch(t){console.error(`Events Handler Error: '${e}()' on '${n}'`,t)}}.bind(this,e.getAttribute(m(n)))})}const o=new MutationObserver(function(e){for(const t of e){for(const e of t.removedNodes)n(e,!0);t.addedNodes.length>0&&r(t.target)}});return o.observe(e,{attributes:!0,characterData:!0,childList:!0,subtree:!0,attributeOldValue:!0,characterDataOldValue:!0}),r(e),o}function S(e={},t={}){const l=[],i=Object.keys(e).filter(t=>!o(e,t)).reduce((t,r)=>({...t,[r]:e[r]}),{}),s=Object.keys(e).filter(t=>o(e,t)).map(t=>n(t,e[t])),a=Object.keys(t).filter(e=>o(t,e)).reduce((e,r)=>({...e,[r]:(...e)=>(t[r].call(this,c,...e),a)}),{});let c=r(i,()=>{s.forEach(e=>e(c)),l.forEach(e=>e(c.___target___))});return s.forEach(e=>e(c)),{...a,$getState:()=>c.___target___,$subscribe:e=>(l.push(e),()=>l.splice(l.indexOf(e),1))}}function k(e,t={},r=null){r&&(e.innerHTML=r);const n=e.cloneNode(!0);!function(e){for(const t of e.querySelectorAll("[\\@call]")){const e=t.getAttribute("@call");t.removeAttribute("@call");let r=["click"];t instanceof HTMLInputElement||t instanceof HTMLTextAreaElement?r=["input","paste"]:t instanceof HTMLInputElement?r=["change"]:t instanceof HTMLFormElement?r=["submit"]:t instanceof HTMLAnchorElement&&t.setAttribute("href","javascript:void(0);");let n=(t.getAttribute(i)||"").split(",").filter(e=>e);n=n.concat(r),t.setAttribute(i,n.join(","));for(const n of r)t.setAttribute(m(n),e)}for(const t of l)for(const r of e.querySelectorAll(`[\\@${t}]`)){const e=(r.getAttribute(i)||"").split(",").filter(e=>e);e.push(t),r.setAttribute(i,e.join(",")),r.setAttribute(m(t),r.getAttribute(`@${t}`)),r.removeAttribute(`@${t}`),r instanceof HTMLAnchorElement&&r.setAttribute("href","javascript:void(0);")}}(n),function(e,t={}){const r={...t,...s};for(const t in r){const n=t.replace("$","");for(const o of f(e,n))if(c(o,n)){const e=u(o,n);r[t](o,e,n)}}}(n),e.innerHTML=n.innerHTML,T(e,t);const o=n.outerHTML;return t=>{const r=N(o,t);return function(e,t=null){return $(e,t),!1}(_(r),e)}}export default function(e={}){const t=["data","el","template","store","mounted","updated"],l={data:{},el:document.body,template:null,store:{},mounted:()=>{},updated:()=>{},...e},i="string"==typeof l.el?document.querySelector(l.el):l.el;if(!(i instanceof HTMLElement))throw new Error(`reLiftHTML setup error: 'el' is not a DOM Element. >> el: ${l.el}`);const s=l.template?l.template:i.innerHTML,a=Object.keys(l).filter(e=>!t.includes(e)).filter(e=>!e.startsWith("$")).filter(e=>o(l,e)).reduce((e,t)=>({...e,[t]:l[t]}),{}),c=Object.keys(l.data).filter(e=>!o(l.data,e)).reduce((e,t)=>({...e,[t]:l.data[t]}),{}),u=Object.keys(l.data).filter(e=>o(l.data,e)).map(e=>n(e,l.data[e]));function d(e){u.forEach(t=>t(e))}let f={$store:{},...c},b=void 0;Object.keys(l.store).length&&(b=l.store,f.$store=l.store.$getState(),l.store.$subscribe(e=>{f.$store=l.store.$getState(),d(f),g()}));const p=r(f,()=>{d(f),g()}),m={...a,el:i,data:p,render:g,store:b};function g(){h(f)}const h=k(i,m,s);document.addEventListener("DOMContentLoaded",()=>{d(f),h(f),l.mounted.call(m),i.style.display="block"})}export{S as reLiftState};
